use exam2;
 
-- SQLINES LICENSE FOR EVALUATION USE ONLY
create table Store (
	CategoryID int,
    BrandName varchar(20),
    ProductName varchar(20),
    Price int,
    Status varchar(10) check (Status in ('InStock','OutOfStock'))
);
 
-- SQLINES LICENSE FOR EVALUATION USE ONLY
create procedure insertData
as
begin
set nocount on;
	declare @flag int = false; 
	declare @Cid int;
    declare @Bname varchar(20);
    declare @Pname varchar(20);
    declare @Pr int;
    declare @Stat varchar(10);
    declare c1 cursor local for select * from json_table(@json,"$[*]"
			columns (
			CategoryID int path "$.CategoryID",
            BrandName varchar(20) path "$.BrandName",
            ProductName varchar(20) path "$.ProductName",
            Price int path "$.Price",
            Status varchar(10) path "$.Status"
        ))as temp;
v_json TEXT;

	DECLARE CONTINUE HANDLER FOR NOT FOUND SET @flag = TRUE;
	set v_json='[
	{
	"CategoryID":1,
        "BrandName":"HP",
        "ProductName":"Laptop",
        "Price":50000,
        "Status":"InStock"
	},
	{
	"CategoryID":2,
        "BrandName":"HP",
        "ProductName":"Mouse",
        "Price":500,
        "Status":"InStock"
	}	
    ]';
    open c1;
    new_loop:while 1=1 begin
		fetch c1 into @Cid,@Bname,@Pname,@Pr,@Stat;
        if @flag begin
			leave new_loop; 
		end 
		-- SQLINES LICENSE FOR EVALUATION USE ONLY
		insert into Store values (@Cid,@Bname,@Pname,@Pr,@Stat);
        select * from Store;
	end;
    close c1;
end;
go %%
 
call insertData();
 
drop table Store;
drop Procedure insertData;